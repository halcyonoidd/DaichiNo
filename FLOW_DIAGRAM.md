# ğŸ¯ Sistem Reservasi + Midtrans - Visual Flow

## Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USER INTERFACE                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    STEP 1: BROWSE PAKET
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  /reservation    â”‚  â† User membuka halaman reservasi
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ reservation.js:                      â”‚
    â”‚ loadReservationOffers()              â”‚
    â”‚ â†“ API GET /api/reservation-offers    â”‚
    â”‚ â†“ Parse response                     â”‚
    â”‚ â†“ Render items di halaman            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Display:                        â”‚
    â”‚  - Paket dengan image            â”‚
    â”‚  - Harga (per person)            â”‚
    â”‚  - Duration, room, capacity      â”‚
    â”‚  - "Reserve Now" button          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    STEP 2: KLIK RESERVE NOW
                       â”‚
                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ openReserve(experienceId)    â”‚
    â”‚ â†“ Get paket dari experiences â”‚
    â”‚ â†“ Populate modal form        â”‚
    â”‚ â†“ Set min date = today       â”‚
    â”‚ â†“ Show modal                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MODAL FORM (Reserve):            â”‚
    â”‚ [Full Name]        [required]    â”‚
    â”‚ [Email]            [required]    â”‚
    â”‚ [Phone]            [required]    â”‚
    â”‚ [Date]             [required]    â”‚
    â”‚ [Time Start]       [required]    â”‚
    â”‚ [Time End]         [required]    â”‚
    â”‚ [Guests]           [1-10]        â”‚
    â”‚ [Special Request]  [optional]    â”‚
    â”‚ â˜ Terms Agreement  [required]   â”‚
    â”‚                                  â”‚
    â”‚ [Confirm Reserve] [Cancel]       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    STEP 3: SUBMIT FORM
                       â”‚
                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ confirmReserveBtn.click              â”‚
    â”‚ â†“ Validate all fields               â”‚
    â”‚ â†“ API POST /api/reservations/       â”‚
    â”‚   availability                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
    AVAILABLE?                    NOT AVAILABLE?
        â”‚                             â”‚
        â†“                             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Continueâ”‚                   â”‚ Show    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                   â”‚ Error   â”‚
         â”‚                       â”‚ Toast   â”‚
         â”‚                       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚                       Back to form
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ addToCart(item)                          â”‚
    â”‚ â†“ Create cart item object                â”‚
    â”‚ â†“ Save to sessionStorage:                â”‚
    â”‚   sessionStorage['pendingReservations']  â”‚
    â”‚ â†“ Close modal                            â”‚
    â”‚ â†“ Show success toast                     â”‚
    â”‚ â†“ Redirect: window.location = '/cart'    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Browser navigates to /cart           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    STEP 4: CART PAGE LOADS
                       â”‚
                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ cart-reservations.js DOMContentLoaded       â”‚
    â”‚ â†“ Read sessionStorage['pendingReservations']â”‚
    â”‚ â†“ For each item:                            â”‚
    â”‚   - Create cartKey = "reservation-..."     â”‚
    â”‚   - Add to localStorage['cart']            â”‚
    â”‚ â†“ Clear sessionStorage                      â”‚
    â”‚ â†“ Call updateCartDisplayWithReservations() â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ CART PAGE DISPLAY:                  â”‚
    â”‚                                     â”‚
    â”‚ Items in Your Cart:                 â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
    â”‚ â”‚ [IMAGE] Reservation Item   Rp... â”‚â”‚
    â”‚ â”‚ Date: 2025-12-25                 â”‚â”‚
    â”‚ â”‚ Time: 18:00 - 20:00              â”‚â”‚
    â”‚ â”‚ Room: Tatami Room A              â”‚â”‚
    â”‚ â”‚ Guests: 2                        â”‚â”‚
    â”‚ â”‚ [âˆ’] 2 [+]  [ğŸ—‘ Remove]          â”‚â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
    â”‚                                     â”‚
    â”‚ ORDER SUMMARY:                      â”‚
    â”‚ Subtotal:     Rp500,000             â”‚
    â”‚ Tax (10%):    Rp50,000              â”‚
    â”‚ Service Fee:  Rp500                 â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
    â”‚ Total:        Rp550,500             â”‚
    â”‚                                     â”‚
    â”‚ [ğŸ’³ Pay Now]  [â† Continue Shopping] â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    STEP 5: USER KLIK PAY NOW
                      â”‚
                      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ payNowBtn.click                      â”‚
    â”‚ â†“ Call initializePayment()           â”‚
    â”‚ â†“ Get CSRF token, customer info     â”‚
    â”‚ â†“ Calculate total amount             â”‚
    â”‚ â†“ Prepare items array                â”‚
    â”‚ â†“ Set button loading state           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ paymentFlow(token, amount, items, customer)    â”‚
    â”‚                                                â”‚
    â”‚ API CALL:                                      â”‚
    â”‚ POST /api/payments/reservation                â”‚
    â”‚ {                                             â”‚
    â”‚   "amount": 550500,                           â”‚
    â”‚   "items": [                                  â”‚
    â”‚     {                                         â”‚
    â”‚       "id": "reservation-1-0",                â”‚
    â”‚       "name": "Kaiseki Experience",           â”‚
    â”‚       "quantity": 2,                          â”‚
    â”‚       "price": 250000                         â”‚
    â”‚     }                                         â”‚
    â”‚   ],                                          â”‚
    â”‚   "customer": {                               â”‚
    â”‚     "full_name": "John Doe",                  â”‚
    â”‚     "email": "john@example.com",              â”‚
    â”‚     "phone": "08123456789"                    â”‚
    â”‚   }                                           â”‚
    â”‚ }                                             â”‚
    â”‚                                               â”‚
    â”‚ RESPONSE:                                     â”‚
    â”‚ {                                             â”‚
    â”‚   "snap_token": "0123abcd...",                â”‚
    â”‚   "order_id": "RESV-1702505400-1234"          â”‚
    â”‚ }                                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ window.snap.pay(snap_token, {...})   â”‚
    â”‚ â†“ Load Midtrans payment gateway      â”‚
    â”‚ â†“ Show payment popup                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MIDTRANS PAYMENT POPUP:          â”‚
    â”‚                                  â”‚
    â”‚ Choose Payment Method:           â”‚
    â”‚ [ğŸ’³ Credit Card]                 â”‚
    â”‚ [ğŸ¦ Bank Transfer]               â”‚
    â”‚ [ğŸ’° E-Wallet]                    â”‚
    â”‚ [ğŸ“± Mobile Banking]              â”‚
    â”‚                                  â”‚
    â”‚ Enter payment details...         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
    SUCCESS        PENDING        ERROR
        â”‚              â”‚              â”‚
        â†“              â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ onSuccessâ”‚  â”‚onPendingâ”‚   â”‚onError â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”‚            â”‚             â”‚
         â†“            â†“             â†“
    Proceed       Proceed       Show Error
    to persist    to persist    Message

    STEP 6: PERSIST RESERVATIONS
                       â”‚
                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ persistReservations(items, customer)   â”‚
    â”‚                                        â”‚
    â”‚ For each reservation item:             â”‚
    â”‚ API CALL:                              â”‚
    â”‚ POST /api/reservations                 â”‚
    â”‚ {                                      â”‚
    â”‚   "reservation_id": 1,                 â”‚
    â”‚   "room": "Tatami Room A",             â”‚
    â”‚   "date": "2025-12-25",                â”‚
    â”‚   "time_start": "18:00",               â”‚
    â”‚   "time_end": "20:00",                 â”‚
    â”‚   "guests": 2,                         â”‚
    â”‚   "full_name": "John Doe",             â”‚
    â”‚   "email": "john@example.com",         â”‚
    â”‚   "phone": "08123456789",              â”‚
    â”‚   "special_request": null              â”‚
    â”‚ }                                      â”‚
    â”‚                                        â”‚
    â”‚ Booking created in DB with status:    â”‚
    â”‚ status = "booked" atau "pending"      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ clearCartReservations()                â”‚
    â”‚ â†“ Remove all reservation items         â”‚
    â”‚   from localStorage['cart']            â”‚
    â”‚ â†“ Keep other items (products, etc)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ updateCartDisplayWithReservations()    â”‚
    â”‚ â†“ Refresh cart display                 â”‚
    â”‚ â†“ Show empty cart or remaining items  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ showNotification('Success!', 'success')â”‚
    â”‚ â†“ Toast message muncul 3 detik        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    âœ“ COMPLETE - USER DAPAT MELIHAT BOOKING DI DATABASE
```

---

## Database Schema

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     RESERVATIONS (PAKET)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                         â”‚
â”‚ title (varchar)                 â”‚
â”‚ badge (varchar)                 â”‚
â”‚ duration (varchar)              â”‚
â”‚ room (varchar)                  â”‚
â”‚ price (decimal)                 â”‚
â”‚ capacity (int)                  â”‚
â”‚ menu (text)                     â”‚
â”‚ image_path (varchar)            â”‚
â”‚ created_at / updated_at         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ 1:N
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESERVATION_BOOKINGS (BOOKING)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                              â”‚
â”‚ reservation_id (FK) â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ reservations.id
â”‚ room (varchar)                       â”‚
â”‚ date (date)                          â”‚
â”‚ time_start (time)                    â”‚
â”‚ time_end (time)                      â”‚
â”‚ guests (int)                         â”‚
â”‚ full_name (varchar)                  â”‚
â”‚ email (varchar)                      â”‚
â”‚ phone (varchar)                      â”‚
â”‚ special_request (text, nullable)     â”‚
â”‚ status (enum: booked/pending/...)   â”‚
â”‚ created_at / updated_at              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Files

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Components                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  /reservation                                              â”‚
â”‚    â”œâ”€â”€ reservation.blade.php                               â”‚
â”‚    â”‚   â””â”€â”€ reservation.js                                  â”‚
â”‚    â”‚       â”œâ”€â”€ loadReservationOffers()                      â”‚
â”‚    â”‚       â”œâ”€â”€ openReserve()                                â”‚
â”‚    â”‚       â”œâ”€â”€ confirmReserveBtn.click                      â”‚
â”‚    â”‚       â”œâ”€â”€ checkAvailability()                          â”‚
â”‚    â”‚       â””â”€â”€ addToCart()                                  â”‚
â”‚    â”‚           â””â”€â”€ redirect to /cart                        â”‚
â”‚    â”‚                                                         â”‚
â”‚  /cart                                                      â”‚
â”‚    â”œâ”€â”€ cart.blade.php                                       â”‚
â”‚    â”œâ”€â”€ cart.js (existing)                                   â”‚
â”‚    â””â”€â”€ cart-reservations.js (NEW)    â† â† â† KEY FILE       â”‚
â”‚        â”œâ”€â”€ loadPendingReservations()                        â”‚
â”‚        â”‚   â†“ read sessionStorage                            â”‚
â”‚        â”œâ”€â”€ updateCartDisplayWithReservations()              â”‚
â”‚        â”œâ”€â”€ initializePayment()                              â”‚
â”‚        â”œâ”€â”€ paymentFlow()                                    â”‚
â”‚        â”‚   â†“ API /api/payments/reservation                 â”‚
â”‚        â”œâ”€â”€ persistReservations()                            â”‚
â”‚        â”‚   â†“ API /api/reservations                         â”‚
â”‚        â””â”€â”€ clearCartReservations()                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Components                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Routes (routes/api.php)                                   â”‚
â”‚  â”œâ”€â”€ GET /api/reservation-offers                           â”‚
â”‚  â”‚   â””â”€â”€ ReservationOfferController@index                  â”‚
â”‚  â”œâ”€â”€ POST /api/reservations/availability                   â”‚
â”‚  â”‚   â””â”€â”€ ReservationController@checkAvailability           â”‚
â”‚  â”œâ”€â”€ POST /api/reservations                                â”‚
â”‚  â”‚   â””â”€â”€ ReservationController@store                       â”‚
â”‚  â””â”€â”€ POST /api/payments/reservation                        â”‚
â”‚      â””â”€â”€ PaymentController@createReservationPayment        â”‚
â”‚                                                             â”‚
â”‚  Models                                                     â”‚
â”‚  â”œâ”€â”€ Reservation                                           â”‚
â”‚  â”‚   â””â”€â”€ bookings() â†’ ReservationBooking                   â”‚
â”‚  â””â”€â”€ ReservationBooking                                    â”‚
â”‚      â””â”€â”€ reservation() â†’ Reservation                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Storage Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser Memory / Storage             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ sessionStorage:                      â”‚
â”‚ â””â”€ pendingReservations: [...]       â”‚
â”‚    (temporary, during flow)          â”‚
â”‚                                      â”‚
â”‚ localStorage:                        â”‚
â”‚ â””â”€ cart: {                           â”‚
â”‚      "reservation-1-...": {...},    â”‚
â”‚      "product-2": {...}              â”‚
â”‚    }                                 â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Server                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ Route Handler                        â”‚
â”‚ â†“                                    â”‚
â”‚ Controller                           â”‚
â”‚ â†“                                    â”‚
â”‚ Validate                             â”‚
â”‚ â†“                                    â”‚
â”‚ Save to Database                     â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ reservations (paket)                 â”‚
â”‚ reservation_bookings (booking)       â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ User Action         â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚ Validation? â”‚
                    â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
                    Noâ”‚         â”‚Yes
              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
              â”‚ Show    â”‚   â”‚ Proceed â”‚
              â”‚ Error   â”‚   â”‚ to next â”‚
              â”‚ Toast   â”‚   â”‚ step    â”‚
              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                   â”‚             â”‚
              Back to form   Continue...
```

---

## State Diagram

```
INITIAL
  â”‚
  â”œâ”€â†’ BROWSE PAKET (reservation.js loaded)
  â”‚     â”œâ”€ paket loaded from API
  â”‚     â””â”€ user can click "Reserve Now"
  â”‚
  â”œâ”€â†’ MODAL OPEN (openReserve called)
  â”‚     â”œâ”€ form fields visible
  â”‚     â””â”€ user filling form
  â”‚
  â”œâ”€â†’ CHECK AVAILABILITY (form submitted)
  â”‚     â”œâ”€ if conflict â†’ show error, stay in MODAL OPEN
  â”‚     â””â”€ if available â†’ proceed to next
  â”‚
  â”œâ”€â†’ SAVE TO SESSION (addToCart called)
  â”‚     â”œâ”€ sessionStorage.pendingReservations = item
  â”‚     â””â”€ redirect to /cart
  â”‚
  â”œâ”€â†’ CART PAGE (cart-reservations.js loaded)
  â”‚     â”œâ”€ read from sessionStorage
  â”‚     â”œâ”€ save to localStorage
  â”‚     â””â”€ render items
  â”‚
  â”œâ”€â†’ READY TO PAY (Pay Now button visible)
  â”‚     â”œâ”€ user can modify quantity
  â”‚     â””â”€ user can remove items
  â”‚
  â”œâ”€â†’ PAYMENT PROCESSING (initializePayment called)
  â”‚     â”œâ”€ create snap token via API
  â”‚     â””â”€ show Midtrans popup
  â”‚
  â”œâ”€â†’ PAYMENT (Midtrans popup)
  â”‚     â”œâ”€ user enters payment details
  â”‚     â”œâ”€ Midtrans processes
  â”‚     â””â”€ return status
  â”‚
  â””â”€â†’ FINISH (onSuccess / onPending / onError)
        â”œâ”€ if success/pending â†’ persist to DB
        â”œâ”€ clear cart
        â””â”€ show message
```

---

**Created with ğŸ’š for seamless reservation flow**
